import csv
import datetime
import os
import glob

def __gen_student_list_fname(_class, sec):
    return "data/student_list/{}_{}/students.csv".format(_class, sec)

def __gen_period_fname(date, _class, sec, period, sub):
    return "data/register/{}/{}_{}/{}_{}.csv".format(
            date.strftime("%d-%m-%y"),
            _class,
            sec,
            period,
            sub
        )

def get_student_list(_class, sec):
    fname = __gen_student_list_fname(_class, sec)
    try:
        f = open(fname, "r", newline='')
    except FileNotFoundError:
        print("ERROR: file {} not found".format(fname))
        return -1
    l = f.read().splitlines()
    f.close()
    return l

def get_absentees(_class, sec, present):
    student_list = get_student_list(_class, sec)
    if student_list == -1:
        return -1
    absentees = []
    for s in student_list:
        if s not in present:
            absentees.append(s)
    return absentees

def add_attendence_rec(csv_file, date, _class, sec, period, sub):
    fname = __gen_period_fname(date, _class, sec, period, sub)
    student_list = get_student_list(_class, sec)
    os.makedirs(os.path.dirname(fname), exist_ok=True)
    try:
        f = open(fname, "w", newline='')
    except FileNotFoundError:
        print("ERROR: file {} not found".format(fname))
        return -1
    w = csv.writer(f)
    for row in csv_file:
        sname = row[0]
        if sname in student_list:
            w.writerow(row)
            student_list.remove(sname)
    for name in student_list:
        w.writerow([name, "", ""])
    f.close()

def get_absentees(date, _class, sec, period):
    fname = __gen_period_fname(date, _class, sec, period, "")
